# -*- coding: utf-8 -*-
"""IQR.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1BqBLSDKqpu0Qu3BIXp2mo16qF4WkPVFx
"""

from google.colab import drive
drive.mount('/content/mydrive')

!pip install pandas pyarrow
!pip install pandas fastparquet

import pandas as pd
import numpy as np

# Ø®ÙˆØ§Ù†Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø§Ø² ÙØ§ÛŒÙ„ CSV
input_file = '//content//mydrive/MyDrive//Colab Notebooks//formation_damage_optimized.parquet'  # Ù†Ø§Ù… ÙØ§ÛŒÙ„ ÙˆØ±ÙˆØ¯ÛŒ
output_cleaned = '//content//mydrive/MyDrive//Colab Notebooks//cleaned_data.csv'
output_removed = '//content//mydrive/MyDrive//Colab Notebooks//removed_outliers.csv'

df = pd.read_parquet(input_file)

# Ø³ØªÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø¨Ø±Ø§ÛŒ Ø¢Ù†Ø§Ù„ÛŒØ²
columns_to_check = ['Temperature_C', 'Pressure_psi', 'Permeability_mD', 'Flow_Rate_bbl_day']

# ØªØ¹Ø±ÛŒÙ ØªØ§Ø¨Ø¹ ØªØ´Ø®ÛŒØµ Ù¾Ø±Øª Ø¨Ø§ Ø±ÙˆØ´ IQR
def detect_outliers_iqr(df, column):
    Q1 = df[column].quantile(0.25)
    Q3 = df[column].quantile(0.75)
    IQR = Q3 - Q1
    lower_bound = Q1 - 1.5 * IQR
    upper_bound = Q3 + 1.5 * IQR
    outliers = df[(df[column] < lower_bound) | (df[column] > upper_bound)]
    return outliers, lower_bound, upper_bound

# Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØºÛŒØ±Ù…Ø¹Ù…ÙˆÙ„
removed_outliers = pd.DataFrame()

# Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù‡Ø± Ø³ØªÙˆÙ†
for col in columns_to_check:
    if col not in df.columns:
        print(f"âš ï¸ Ø³ØªÙˆÙ† '{col}' ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯ Ùˆ Ø§Ø² Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø­Ø°Ù Ø´Ø¯.")
        continue

    outliers, lb, ub = detect_outliers_iqr(df, col)
    print(f"\nğŸ“Š {col}:")
    print(f"Ø­Ø¯ Ù¾Ø§ÛŒÛŒÙ† IQR: {lb:.2f}, Ø­Ø¯ Ø¨Ø§Ù„Ø§ÛŒ IQR: {ub:.2f}")
    print(f"ØªØ¹Ø¯Ø§Ø¯ Ù…Ù‚Ø§Ø¯ÛŒØ± Ù¾Ø±Øª: {len(outliers)}")

    removed_outliers = pd.concat([removed_outliers, outliers], axis=0)

# Ø­Ø°Ù Ø³Ø·Ø±Ù‡Ø§ÛŒ Ø¯Ø§Ø±Ø§ÛŒ Ù…Ù‚Ø§Ø¯ÛŒØ± Ù¾Ø±Øª Ø§Ø² Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ
cleaned_df = df.drop(removed_outliers.index).reset_index(drop=True)

# Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØªÙ…ÛŒØ² Ø´Ø¯Ù‡
cleaned_df.to_csv(output_cleaned, index=False)
print(f"\nâœ… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØªÙ…ÛŒØ² Ø´Ø¯Ù‡ Ø¯Ø± ÙØ§ÛŒÙ„ '{output_cleaned}' Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.")

# Ø°Ø®ÛŒØ±Ù‡ Ù…Ù‚Ø§Ø¯ÛŒØ± Ù¾Ø±Øª Ø¯Ø± ÛŒÚ© ÙØ§ÛŒÙ„ Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡
if not removed_outliers.empty:
    removed_outliers.to_csv(output_removed, index=False)
    print(f" Ù…Ù‚Ø§Ø¯ÛŒØ± Ù¾Ø±Øª Ø¯Ø± ÙØ§ÛŒÙ„ '{output_removed}' Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.")
else:
    print(" Ù‡ÛŒÚ† Ù…Ù‚Ø¯Ø§Ø± Ù¾Ø±ØªÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.")